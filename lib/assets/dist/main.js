(()=>{async function g(a,r){a.importCSS("main.css"),a.root.innerHTML=r,await a.importJS("https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js");let d={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};async function l(){console.log("Starting.....");let i=await window.navigator.mediaDevices.getUserMedia({video:{width:300,height:300},audio:!1}),o=document.getElementById("source");o.srcObject=i,await o.play(),await faceapi.nets.tinyFaceDetector.loadFromUri("https://github.com/dwyl/webrtc-sfu-demo/blob/main/assets/model/");async function m(e){let n={width:e.width,height:e.height},c=faceapi.createCanvasFromMedia(e);faceapi.matchDimensions(c,n);async function s(){c.getContext("2d").drawImage(e,0,0,n.width,n.height);let p=await faceapi.detectAllFaces(e,new faceapi.TinyFaceDetectorOptions),w=faceapi.resizeResults(p,n);faceapi.draw.drawDetections(c,w),e.requestVideoFrameCallback(s)}return e.requestVideoFrameCallback(s),c.captureStream(30)}let f=await m(o),t=new RTCPeerConnection(d);f.getTracks().forEach(e=>t.addTrack(e,i)),t.onicecandidate=({candidate:e})=>{e!==null&&a.pushEvent("ice",{candidate:e.toJSON(),type:"ice"})},t.onnegotiationneeded=async()=>{let e=await t.createOffer();await t.setLocalDescription(e),console.log("--> Offer created and sent"),a.pushEvent("offer",{sdp:e})},t.ontrack=({streams:e})=>{console.log("--> Received remote track");let n=document.querySelector("#echo");n.srcObject=e[0]},a.handleEvent("ice",async({candidate:e})=>{await t.addIceCandidate(e)}),a.handleEvent("answer",async e=>{console.log("--> handled Answer"),await t.setRemoteDescription(e)}),t.onconnectionstatechange=()=>{console.log("~~> Connection state: ",t.connectionState)}}l()}})();
//# sourceMappingURL=main.js.map
